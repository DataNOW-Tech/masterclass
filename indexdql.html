<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DataNOW's Exclusive MS SQL Masterclass</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --brand-blue: #145da1;
            --brand-red: #ee272a;
            --brand-yellow: #fed966;
            --brand-white: #ffffff;
            --brand-dark: #2d3748;
            --brand-light-gray: #f7fafc;
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--brand-light-gray);
            color: var(--brand-dark);
        }
        .active-nav {
            color: var(--brand-yellow); 
            font-weight: 600;
            position: relative;
        }
        .active-nav::after {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 0;
            right: 0;
            height: 3px;
            background-color: var(--brand-yellow);
        }
        .code-block {
            background-color: #263238;
            color: #eceff1;
            padding: 1rem;
            border-radius: 0.5rem;
            font-family: 'Courier New', Courier, monospace;
            white-space: pre-wrap;
            word-break: break-all;
        }
        .fade-in-section {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.6s ease-out, transform 0.6s ease-out;
        }
        .fade-in-section.visible {
            opacity: 1;
            transform: translateY(0);
        }
        .query-playground textarea {
            background-color: #263238;
            color: #82aaff;
            font-family: 'Courier New', Courier, monospace;
            border: 1px solid #4a5568;
        }
        .query-playground button {
            background-color: var(--brand-blue);
            transition: background-color 0.3s;
        }
         .query-playground button:hover {
            background-color: #0f4a81;
        }
        .locked-answer {
            background-color: #e2e8f0;
            border: 2px dashed #94a3b8;
            color: transparent;
            user-select: none;
            filter: blur(4px);
            transition: all 0.3s ease-in-out;
        }
        .unlocked-answer {
            background-color: #f0fdf4;
            border: 2px solid #22c55e;
            filter: blur(0);
            color: inherit;
        }
        .sql-command-map .category-box {
            background-color: var(--brand-blue);
            color: var(--brand-white);
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 700;
            text-align: center;
        }
        .sql-command-map .command-group {
            border-left: 2px solid var(--brand-blue);
            padding-left: 1.5rem;
            margin-left: 1rem;
        }
        .sql-command-map .command-item {
            background-color: var(--brand-white);
            border: 1px solid #cbd5e1;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            margin-bottom: 0.5rem;
        }
        .sql-command-map .highlight-current .category-box {
            background-color: var(--brand-red);
        }
        .sql-command-map .highlight-current .command-group {
             border-left: 2px solid var(--brand-red);
        }
        .sql-command-map .highlight-previous .category-box {
            background-color: #a0aec0;
        }
    </style>
</head>
<body class="antialiased">

    <nav id="navbar" class="bg-[var(--brand-blue)] sticky top-0 z-50 shadow-md">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-20">
                <div class="flex items-center flex-shrink-0">
                    <span class="text-2xl font-bold text-white">DataNOW, Inc.</span>
                </div>
                 <div class="hidden md:block">
                    <div id="desktop-menu" class="ml-10 flex items-baseline space-x-4">
                        <a href="#intro" class="nav-link px-3 py-2 rounded-md text-sm font-medium text-gray-200 hover:text-white">Introduction</a>
                        <a href="#sql-map" class="nav-link px-3 py-2 rounded-md text-sm font-medium text-gray-200 hover:text-white">SQL Map</a>
                        <a href="#fundamentals" class="nav-link px-3 py-2 rounded-md text-sm font-medium text-gray-200 hover:text-white">Fundamentals</a>
                        <a href="#querying" class="nav-link px-3 py-2 rounded-md text-sm font-medium text-gray-200 hover:text-white">Querying Data</a>
                        <a href="#playground" class="nav-link px-3 py-2 rounded-md text-sm font-medium text-gray-200 hover:text-white">Playground</a>
                        <a href="#lab" class="nav-link px-3 py-2 rounded-md text-sm font-medium text-gray-200 hover:text-white">SSMS Lab</a>
                        <a href="#activity" class="nav-link px-3 py-2 rounded-md text-sm font-medium text-gray-200 hover:text-white">Activity</a>
                    </div>
                </div>
                <div class="-mr-2 flex md:hidden">
                    <button id="mobile-menu-button" type="button" class="bg-gray-800 inline-flex items-center justify-center p-2 rounded-md text-gray-400 hover:text-white hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-white">
                        <span class="sr-only">Open main menu</span>
                        <svg id="hamburger-icon" class="block h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                        </svg>
                        <svg id="close-icon" class="hidden h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>
            </div>
        </div>
        <div id="mobile-menu" class="md:hidden hidden">
            <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
                <a href="#intro" class="nav-link-mobile block px-3 py-2 rounded-md text-base font-medium text-gray-200 hover:text-white hover:bg-gray-700">Introduction</a>
                <a href="#sql-map" class="nav-link-mobile block px-3 py-2 rounded-md text-base font-medium text-gray-200 hover:text-white hover:bg-gray-700">SQL Map</a>
                <a href="#fundamentals" class="nav-link-mobile block px-3 py-2 rounded-md text-base font-medium text-gray-200 hover:text-white hover:bg-gray-700">Fundamentals</a>
                <a href="#querying" class="nav-link-mobile block px-3 py-2 rounded-md text-base font-medium text-gray-200 hover:text-white hover:bg-gray-700">Querying Data</a>
                <a href="#playground" class="nav-link-mobile block px-3 py-2 rounded-md text-base font-medium text-gray-200 hover:text-white hover:bg-gray-700">Playground</a>
                <a href="#lab" class="nav-link-mobile block px-3 py-2 rounded-md text-base font-medium text-gray-200 hover:text-white hover:bg-gray-700">SSMS Lab</a>
                <a href="#activity" class="nav-link-mobile block px-3 py-2 rounded-md text-base font-medium text-gray-200 hover:text-white hover:bg-gray-700">Activity</a>
            </div>
        </div>
    </nav>

    <main>
        <section id="intro" class="py-16 sm:py-20">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center fade-in-section">
                <h1 class="text-4xl sm:text-5xl font-extrabold text-[var(--brand-dark)] tracking-tight">DataNOW's Masterclass</h1>
                <p class="mt-4 max-w-3xl mx-auto text-lg text-gray-700">Welcome! This session focuses on Data Query Language (DQL), the part of SQL used to retrieve data from your tables. This is the most common part of SQL you will use.</p>
            </div>
        </section>

        <section id="sql-map" class="py-16 sm:py-20 bg-gray-100">
            <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 fade-in-section sql-command-map">
                <h2 class="text-3xl font-bold text-center text-[var(--brand-dark)] tracking-tight">SQL Command Overview</h2>
                <div class="mt-8 grid grid-cols-1 md:grid-cols-3 gap-8">
                    <div class="highlight-previous">
                        <div class="category-box">DML (Previous Topic)</div>
                        <div class="command-group mt-4 space-y-2">
                            <div class="command-item">INSERT</div>
                            <div class="command-item">UPDATE</div>
                            <div class="command-item">DELETE</div>
                        </div>
                    </div>
                    <div class="highlight-current">
                        <div class="category-box">DQL (Current Topic)</div>
                        <div class="command-group mt-4 space-y-2">
                            <div class="command-item">SELECT</div>
                        </div>
                    </div>
                    <div>
                        <div class="category-box">DDL (Future Topic)</div>
                        <div class="command-group mt-4 space-y-2">
                            <div class="command-item">CREATE</div>
                            <div class="command-item">ALTER</div>
                            <div class="command-item">DROP</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="fundamentals" class="py-16 sm:py-20">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 fade-in-section">
                <div class="text-center">
                    <h2 class="text-3xl font-bold text-[var(--brand-dark)] tracking-tight">DQL Fundamentals</h2>
                    <p class="mt-4 text-lg max-w-3xl mx-auto text-gray-700">To query a database, you must first understand its structure. Use the tabs to explore each fundamental concept.</p>
                </div>
                <div class="mt-12 max-w-5xl mx-auto">
                    <div class="mb-4 border-b border-gray-300">
                        <ul class="flex flex-wrap -mb-px" id="fundamentals-tabs">
                            <li class="mr-2"><button data-tab="tab-what-is-dql" class="fundamentals-tab-button inline-block p-4 border-b-2 rounded-t-lg font-semibold">What is DQL?</button></li>
                            <li class="mr-2"><button data-tab="tab-select" class="fundamentals-tab-button inline-block p-4 border-b-2 rounded-t-lg">SELECT & FROM</button></li>
                            <li class="mr-2"><button data-tab="tab-where" class="fundamentals-tab-button inline-block p-4 border-b-2 rounded-t-lg">Filtering with WHERE</button></li>
                            <li class="mr-2"><button data-tab="tab-orderby" class="fundamentals-tab-button inline-block p-4 border-b-2 rounded-t-lg">Sorting with ORDER BY</button></li>
                            <li class="mr-2"><button data-tab="tab-aggregates" class="fundamentals-tab-button inline-block p-4 border-b-2 rounded-t-lg">Aggregate Functions</button></li>
                            <li class="mr-2"><button data-tab="tab-joins" class="fundamentals-tab-button inline-block p-4 border-b-2 rounded-t-lg">JOIN Types</button></li>
                            <li class="mr-2"><button data-tab="tab-subqueries" class="fundamentals-tab-button inline-block p-4 border-b-2 rounded-t-lg">Subqueries & CTEs</button></li>
                            <li class="mr-2"><button data-tab="tab-having" class="fundamentals-tab-button inline-block p-4 border-b-2 rounded-t-lg">HAVING Clause</button></li>
                            <li class="mr-2"><button data-tab="tab-window" class="fundamentals-tab-button inline-block p-4 border-b-2 rounded-t-lg">Window Functions</button></li>
                            <li class="mr-2"><button data-tab="tab-nulls" class="fundamentals-tab-button inline-block p-4 border-b-2 rounded-t-lg">Handling NULLs</button></li>
                            <li class="mr-2"><button data-tab="tab-views" class="fundamentals-tab-button inline-block p-4 border-b-2 rounded-t-lg">Views</button></li>
                        </ul>
                    </div>
                    <div id="fundamentals-content" class="bg-brand-white p-6 rounded-lg shadow-lg">
                        <div id="tab-what-is-dql" class="fundamentals-tab-content space-y-4"></div>
                        <div id="tab-select" class="fundamentals-tab-content hidden space-y-6"></div>
                        <div id="tab-where" class="fundamentals-tab-content hidden space-y-4"></div>
                        <div id="tab-orderby" class="fundamentals-tab-content hidden space-y-4"></div>
                        <div id="tab-aggregates" class="fundamentals-tab-content hidden space-y-4"></div>
                        <div id="tab-joins" class="fundamentals-tab-content hidden space-y-4"></div>
                        <div id="tab-subqueries" class="fundamentals-tab-content hidden space-y-4"></div>
                        <div id="tab-having" class="fundamentals-tab-content hidden space-y-4"></div>
                        <div id="tab-window" class="fundamentals-tab-content hidden space-y-4"></div>
                        <div id="tab-nulls" class="fundamentals-tab-content hidden space-y-4"></div>
                        <div id="tab-views" class="fundamentals-tab-content hidden space-y-4"></div>
                    </div>
                </div>
            </div>
        </section>
        
        <section id="querying" class="py-16 sm:py-20 bg-gray-100">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 fade-in-section">
                <div class="text-center">
                    <h2 class="text-3xl font-bold text-[var(--brand-dark)] tracking-tight">Querying Data with DQL</h2>
                    <p class="mt-4 text-lg max-w-3xl mx-auto text-gray-700">This section is a code explorer for the most fundamental DQL commands.</p>
                </div>
                <div class="mt-12 md:flex md:space-x-8">
                    <div class="md:w-1/4 mb-8 md:mb-0">
                        <div class="space-y-2">
                            <button data-command="select" class="command-button w-full text-left p-3 rounded-md font-medium bg-gray-200 hover:bg-gray-300">SELECT & FROM</button>
                            <button data-command="where" class="command-button w-full text-left p-3 rounded-md font-medium bg-gray-200 hover:bg-gray-300">WHERE</button>
                            <button data-command="orderby" class="command-button w-full text-left p-3 rounded-md font-medium bg-gray-200 hover:bg-gray-300">ORDER BY</button>
                            <button data-command="join" class="command-button w-full text-left p-3 rounded-md font-medium bg-gray-200 hover:bg-gray-300">INNER JOIN</button>
                        </div>
                    </div>
                    <div class="md:w-3/4 bg-brand-white p-6 rounded-lg shadow-lg">
                        <div id="command-display" class="space-y-4">
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="playground" class="py-16 sm:py-20 bg-gray-100">
            <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 fade-in-section query-playground">
                <div class="text-center">
                    <h2 class="text-3xl font-bold text-[var(--brand-dark)] tracking-tight">DQL Playground</h2>
                    <p class="mt-4 text-lg text-gray-700">Time to query data! Write `SELECT` statements in the editor below. The application will simulate the result by showing you the resulting table.</p>
                </div>
                <div id="playground-container" class="mt-12 bg-brand-white p-6 rounded-lg shadow-lg">
                </div>
            </div>
        </section>
        
        <section id="lab" class="py-16 sm:py-20 bg-gray-100">
             <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 fade-in-section">
                <div class="text-center">
                    <h2 class="text-3xl font-bold text-[var(--brand-dark)] tracking-tight">Hands-On Lab (SSMS)</h2>
                    <p class="mt-4 text-lg text-gray-700">For a full database experience, download the script below, run it in SSMS, and then tackle the challenges.</p>
                </div>
                <div class="mt-12 space-y-8">
                    <div id="lab-challenges" class="space-y-8"></div>
                </div>
            </div>
        </section>
        
        <section id="activity" class="py-16 sm:py-20">
            <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 fade-in-section">
               <div class="text-center">
                   <h2 class="text-3xl font-bold text-[var(--brand-dark)] tracking-tight">Activity for Next Week</h2>
                   <p class="mt-4 text-lg text-gray-700">Apply what you've learned! Use the `SampleDB` database from the SSMS Lab to solve these challenges. Enter the instructor password to unlock the answers.</p>
               </div>
               <div id="activity-container" class="mt-12">
               </div>
           </div>
       </section>
    </main>
    
    <footer class="bg-[var(--brand-dark)]">
        <div class="max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8 text-center text-sm text-gray-300">
            <p>DataNOW's Exclusive MS SQL Masterclass | A Learning Resource</p>
        </div>
    </footer>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const { jsPDF } = window.jspdf;

    const brandColors = {
        blue: '#145da1',
        red: '#ee272a',
        yellow: '#fed966',
    };
    
    const dqlCommandsData = {
        select: { title: 'SELECT & FROM', description: 'Specifies the columns you want (`SELECT`) from a specific table (`FROM`).', code: `SELECT CustomerName, City\nFROM Customers;` },
        where: { title: 'WHERE', description: 'Filters data to show only rows that meet a condition.', code: `SELECT *\nFROM Products\nWHERE Price > 50;` },
        orderby: { title: 'ORDER BY', description: 'Sorts your results. Use `ASC` for ascending (default) or `DESC` for descending.', code: `SELECT ProductName, Price\nFROM Products\nORDER BY Price DESC;` },
        join: { title: 'INNER JOIN', description: 'Combines rows from two tables based on a related column between them.', code: `SELECT o.OrderID, c.CustomerName\nFROM Orders AS o\nINNER JOIN Customers AS c ON o.CustomerID = c.CustomerID;` }
    };
    
    const labChallengesData = [
        {
            title: 'Lab Task 1: Basic Queries',
            challenges: [
                { prompt: "1. Retrieve all columns for all customers.", solution: "SELECT * FROM Sales.Customers;" },
                { prompt: "2. Select only the `ProductName` and `Price` from the `Products` table.", solution: "SELECT ProductName, Price FROM Products;" },
            ]
        },
        {
            title: 'Lab Task 2: Filtering Data',
            challenges: [
                { prompt: "3. Find all customers who live in 'Germany'.", solution: "SELECT * FROM Sales.Customers WHERE Country = 'Germany';" },
                { prompt: "4. Find all products with a price greater than 50.", solution: "SELECT * FROM Products WHERE Price > 50;" },
            ]
        },
        {
            title: 'Lab Task 3: Sorting Data',
            challenges: [
                { prompt: "5. List all customers ordered by their name alphabetically.", solution: "SELECT * FROM Sales.Customers ORDER BY CustomerName;" },
                { prompt: "6. List all products from most expensive to least expensive.", solution: "SELECT * FROM Products ORDER BY Price DESC;" },
            ]
        },
        {
            title: 'Lab Task 4: Aggregate Functions',
            challenges: [
                 { prompt: "7. Count the total number of customers.", solution: "SELECT COUNT(*) FROM Sales.Customers;" },
                 { prompt: "8. Find the average price of all products.", solution: "SELECT AVG(Price) FROM Products;" },
                 { prompt: "9. Find the highest price among all products.", solution: "SELECT MAX(Price) FROM Products;" },
            ]
        },
        {
            title: 'Lab Task 5: Grouping Data',
            challenges: [
                 { prompt: "10. Count the number of customers in each country.", solution: "SELECT Country, COUNT(*) AS CustomerCount\nFROM Sales.Customers\nGROUP BY Country;" },
            ]
        }
    ];

    const playgroundData = {
        initialData: [
            { id: 1, name: 'Alice', department: 'Sales', salary: 70000 },
            { id: 2, name: 'Bob', department: 'Engineering', salary: 95000 },
            { id: 3, name: 'Charlie', department: 'Engineering', salary: 110000 },
            { id: 4, name: 'Diana', department: 'Sales', salary: 85000 },
            { id: 5, name: 'Eve', department: 'Marketing', salary: 60000 },
        ],
        challenges: [
            {
                question: "Select the name and salary of all employees.",
                validate: (query) => /SELECT\s+name,\s*salary\s+FROM\s+employees/i.test(query.trim()),
            },
            {
                question: "Find all employees who work in the 'Engineering' department.",
                validate: (query) => /SELECT\s+\*\s+FROM\s+employees\s+WHERE\s+department\s*=\s*'Engineering'/i.test(query.trim()),
            },
            {
                question: "List all employees ordered by their salary in descending order.",
                validate: (query) => /SELECT\s+\*\s+FROM\s+employees\s+ORDER\s+BY\s+salary\s+DESC/i.test(query.trim()),
            },
            {
                question: "Count the number of employees in each department.",
                validate: (query) => /SELECT\s+department,\s*COUNT\(\*\)\s+FROM\s+employees\s+GROUP\s+BY\s+department/i.test(query.replace(/\n/g, " ")),
            },
            {
                question: "Find the average salary for the 'Sales' department.",
                validate: (query) => /SELECT\s+AVG\(salary\)\s+FROM\s+employees\s+WHERE\s+department\s*=\s*'Sales'/i.test(query.trim()),
            }
        ]
    };
    let currentPlaygroundChallenge = 0;

    const activityData = [
        { question: "Find all customers from 'Mexico' or 'Germany'.", answer: `SELECT * FROM Customers WHERE Country IN ('Mexico', 'Germany');` },
        { question: "List all customers whose name starts with 'A'.", answer: `SELECT * FROM Customers WHERE CustomerName LIKE 'A%';` },
        { question: "How many orders has each customer placed?", answer: `SELECT c.CustomerName, COUNT(o.OrderID) AS NumberOfOrders FROM Customers c LEFT JOIN Orders o ON c.CustomerID = o.CustomerID GROUP BY c.CustomerName;`},
        { question: "What is the average price of all products?", answer: `SELECT AVG(Price) AS AveragePrice FROM Products;`},
        { question: "List the names of products that have been ordered.", answer: `SELECT DISTINCT p.ProductName FROM Products p JOIN Orders o ON o.ProductID = p.ProductID;`},
        { question: "Find the most expensive product.", answer: `SELECT * FROM Products ORDER BY Price DESC LIMIT 1;`},
        { question: "Find all customers who have not placed any orders.", answer: `SELECT c.CustomerName FROM Customers c LEFT JOIN Orders o ON c.CustomerID = o.CustomerID WHERE o.OrderID IS NULL;`},
        { question: "List all products and their categories, but show 'No Category' if the category is null.", answer: `SELECT ProductName, ISNULL(Category, 'No Category') AS Category FROM Products;`},
        { question: "Find the total sales amount for each customer.", answer: `SELECT c.CustomerName, SUM(p.Price * o.Quantity) AS TotalSales\nFROM Customers c\nJOIN Orders o ON c.CustomerID = o.CustomerID\nJOIN Products p ON o.ProductID = p.ProductID\nGROUP BY c.CustomerName;`},
        { question: "List the top 3 countries with the most customers.", answer: `SELECT TOP 3 Country, COUNT(*) AS CustomerCount\nFROM Customers\nGROUP BY Country\nORDER BY CustomerCount DESC;`},
    ];
    let currentActivityIndex = 0;
    const labPassword = "DQL_Lab_Access";
    const activityPassword = "DataQueryPro25";

    const animationObserver = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) entry.target.classList.add('visible');
        });
    }, { threshold: 0.1 });
    document.querySelectorAll('.fade-in-section').forEach(section => animationObserver.observe(section));

    const mobileMenuButton = document.getElementById('mobile-menu-button');
    const mobileMenu = document.getElementById('mobile-menu');
    const hamburgerIcon = document.getElementById('hamburger-icon');
    const closeIcon = document.getElementById('close-icon');

    mobileMenuButton.addEventListener('click', () => {
        mobileMenu.classList.toggle('hidden');
        hamburgerIcon.classList.toggle('hidden');
        closeIcon.classList.toggle('hidden');
    });

    document.querySelectorAll('.nav-link-mobile').forEach(link => {
        link.addEventListener('click', () => {
            mobileMenu.classList.add('hidden');
            hamburgerIcon.classList.remove('hidden');
            closeIcon.classList.add('hidden');
        });
    });

    window.addEventListener('scroll', () => {
        let current = '';
        document.querySelectorAll('main section').forEach(section => {
            const sectionTop = section.offsetTop;
            if (pageYOffset >= sectionTop - 150) {
                current = section.getAttribute('id');
            }
        });

        document.querySelectorAll('.nav-link').forEach(link => {
            link.classList.remove('active-nav');
            if (link.getAttribute('href') === `#${current}`) {
                link.classList.add('active-nav');
            }
        });
    });

    const fundamentalsTabs = document.getElementById('fundamentals-tabs');
    const fundamentalsTabButtons = fundamentalsTabs.querySelectorAll('.fundamentals-tab-button');
    const fundamentalsTabContents = document.getElementById('fundamentals-content').querySelectorAll('.fundamentals-tab-content');
    
    document.querySelector('#tab-what-is-dql').innerHTML = `<h3 class="text-xl font-semibold">What is DQL?</h3><p>Data Query Language (DQL) is the most common part of SQL, used to retrieve data from your database. The <code>SELECT</code> statement is the core of DQL.</p><div class="text-center mt-4"><span class="text-6xl">🔍</span></div>`;
    document.querySelector('#tab-select').innerHTML = `<h3 class="text-xl font-semibold">The SELECT & FROM Statement</h3><p><code>SELECT</code> specifies the columns you want to retrieve, and <code>FROM</code> specifies the table you are querying.</p><div class="code-block mt-4">SELECT CustomerName, Country\nFROM Customers;</div>`;
    document.querySelector('#tab-where').innerHTML = `<h3 class="text-xl font-semibold">Filtering with WHERE</h3><p>The <code>WHERE</code> clause is used to filter records and extract only those that fulfill a specified condition.</p><div class="code-block mt-4">SELECT * FROM Products\nWHERE Price > 50;</div>`;
    document.querySelector('#tab-orderby').innerHTML = `<h3 class="text-xl font-semibold">Sorting with ORDER BY</h3><p>The <code>ORDER BY</code> keyword is used to sort the result-set in ascending (ASC) or descending (DESC) order.</p><div class="code-block mt-4">SELECT * FROM Products\nORDER BY Price DESC;</div>`;
    document.querySelector('#tab-aggregates').innerHTML = `<h3 class="text-xl font-semibold">Aggregate Functions</h3><p>Aggregate functions perform a calculation on a set of values and return a single value. Common functions include <code>COUNT()</code>, <code>SUM()</code>, <code>AVG()</code>, <code>MIN()</code>, and <code>MAX()</code>.</p><div class="code-block mt-4">SELECT COUNT(ProductID)\nFROM Products;</div>`;
    document.querySelector('#tab-joins').innerHTML = `<h3 class="text-xl font-semibold">JOIN Types</h3><p>JOIN clauses are used to combine rows from two or more tables, based on a related column between them.</p><div class="space-y-2 mt-4"><p><strong>INNER JOIN:</strong> Returns records that have matching values in both tables.</p><p><strong>LEFT JOIN:</strong> Returns all records from the left table, and the matched records from the right table.</p><p><strong>RIGHT JOIN:</strong> Returns all records from the right table, and the matched records from the left table.</p><p><strong>FULL OUTER JOIN:</strong> Returns all records when there is a match in either left or right table.</p></div>`;
    document.querySelector('#tab-subqueries').innerHTML = `<h3 class="text-xl font-semibold">Subqueries & CTEs</h3><p>A subquery is a query nested inside another query. A Common Table Expression (CTE) is a temporary named result set that you can reference within another SQL statement.</p><div class="code-block mt-4">-- Subquery Example\nSELECT ProductName\nFROM Products\nWHERE ProductID IN (SELECT ProductID FROM OrderDetails WHERE Quantity > 100);\n\n-- CTE Example\nWITH HighQuantityOrders AS (\n    SELECT ProductID FROM OrderDetails WHERE Quantity > 100\n)\nSELECT p.ProductName\nFROM Products p\nJOIN HighQuantityOrders h ON p.ProductID = h.ProductID;</div>`;
    document.querySelector('#tab-having').innerHTML = `<h3 class="text-xl font-semibold">HAVING Clause</h3><p>The <code>HAVING</code> clause was added to SQL because the <code>WHERE</code> keyword cannot be used with aggregate functions. It filters groups after the <code>GROUP BY</code> clause has been applied.</p><div class="code-block mt-4">SELECT Country, COUNT(CustomerID) AS CustomerCount\nFROM Customers\nGROUP BY Country\nHAVING COUNT(CustomerID) > 5;</div>`;
    document.querySelector('#tab-window').innerHTML = `<h3 class="text-xl font-semibold">Window Functions</h3><p>Window functions perform a calculation across a set of table rows that are somehow related to the current row. This is comparable to the type of calculation that can be done with an aggregate function. But unlike regular aggregate functions, use of a window function does not cause rows to become grouped into a single output row.</p>
    <div class="overflow-x-auto mt-4"><table class="w-full text-sm text-left"><thead><tr class="bg-gray-100"><th class="p-2">Function</th><th class="p-2">Description</th><th class="p-2">Example (Score: 100, 90, 90, 80)</th></tr></thead><tbody>
    <tr class="border-b"><td class="p-2"><code>ROW_NUMBER()</code></td><td class="p-2">Assigns a unique number to each row.</td><td class="p-2">1, 2, 3, 4</td></tr>
    <tr class="border-b"><td class="p-2"><code>RANK()</code></td><td class="p-2">Assigns a rank to each row. Skips ranks after ties.</td><td class="p-2">1, 2, 2, 4</td></tr>
    <tr class="border-b"><td class="p-2"><code>DENSE_RANK()</code></td><td class="p-2">Assigns a rank to each row. Does not skip ranks after ties.</td><td class="p-2">1, 2, 2, 3</td></tr>
    <tr class="border-b"><td class="p-2"><code>NTILE(N)</code></td><td class="p-2">Distributes rows into a specified number (N) of groups.</td><td class="p-2">e.g., NTILE(2) -> 1, 1, 2, 2</td></tr>
    </tbody></table></div>`;
    document.querySelector('#tab-nulls').innerHTML = `<h3 class="text-xl font-semibold">Handling NULLs</h3><p><code>NULL</code> represents a missing or unknown value. It is not the same as zero or an empty string. Use <code>IS NULL</code> and <code>IS NOT NULL</code> to check for these values. The <code>ISNULL()</code> or <code>COALESCE()</code> functions can be used to provide a default value for NULLs.</p><div class="code-block mt-4">SELECT CustomerName, ISNULL(Region, 'N/A') AS Region\nFROM Customers;</div>`;
    document.querySelector('#tab-views').innerHTML = `<h3 class="text-xl font-semibold">Views</h3><p>A view is a virtual table based on the result-set of an SQL statement. It contains rows and columns, just like a real table. The fields in a view are fields from one or more real tables in the database.</p><div class="code-block mt-4">CREATE VIEW [Brazil Customers] AS\nSELECT CustomerName, ContactName\nFROM Customers\nWHERE Country = 'Brazil';\n\n-- Querying the view\nSELECT * FROM [Brazil Customers];</div>`;

    fundamentalsTabs.addEventListener('click', (e) => {
        if (e.target.tagName === 'BUTTON') {
            const tabId = e.target.getAttribute('data-tab');
            fundamentalsTabButtons.forEach(btn => {
                btn.classList.remove('border-[var(--brand-blue)]', 'text-[var(--brand-blue)]');
                btn.classList.add('border-transparent', 'hover:text-gray-600', 'hover:border-gray-300');
            });
            e.target.classList.add('border-[var(--brand-blue)]', 'text-[var(--brand-blue)]');
            e.target.classList.remove('border-transparent');
            fundamentalsTabContents.forEach(content => content.classList.add('hidden'));
            document.getElementById(tabId).classList.remove('hidden');
        }
    });
    fundamentalsTabButtons[0].click();
    
    const commandButtonsContainer = document.querySelector('#querying .md\\:w-1\\/4 .space-y-2');
    const commandDisplay = document.getElementById('command-display');
    commandButtonsContainer.addEventListener('click', e => {
        if (e.target.tagName === 'BUTTON') {
            const command = e.target.dataset.command;
            commandButtonsContainer.querySelectorAll('button').forEach(btn => {
                btn.classList.remove('bg-[var(--brand-blue)]', 'text-white');
                btn.classList.add('bg-gray-200', 'hover:bg-gray-300');
            });
            e.target.classList.add('bg-[var(--brand-blue)]', 'text-white');
            e.target.classList.remove('bg-gray-200');
            const data = dqlCommandsData[command];
            commandDisplay.innerHTML = `<h3 class="text-xl font-semibold">${data.title}</h3><p>${data.description}</p><div class="code-block">${data.code.replace(/</g, "&lt;")}</div>`;
        }
    });
    commandButtonsContainer.querySelector('button').click();

    const labContainer = document.getElementById('lab-challenges');
    labChallengesData.forEach((taskGroup, groupIndex) => {
        const groupEl = document.createElement('div');
        groupEl.className = 'bg-brand-white p-6 rounded-lg shadow-lg';
        const titleEl = document.createElement('h3');
        titleEl.className = 'text-xl font-semibold text-[var(--brand-dark)] mb-4';
        titleEl.textContent = taskGroup.title;
        groupEl.appendChild(titleEl);

        const questionsContainer = document.createElement('div');
        questionsContainer.className = 'space-y-3 mb-4';
        taskGroup.challenges.forEach(challenge => {
             questionsContainer.innerHTML += `<p class="font-medium">${challenge.prompt}</p>`;
        });
        groupEl.appendChild(questionsContainer);
        
        const solutionsDiv = document.createElement('div');
        solutionsDiv.className = 'locked-answer p-4 rounded-lg';
        solutionsDiv.setAttribute('data-answer-id', `lab-${groupIndex}`);
        const challengesSolutions = document.createElement('div');
        challengesSolutions.className = 'space-y-3';
        taskGroup.challenges.forEach(challenge => {
            let hintHTML = challenge.hint ? `<p class="text-sm text-gray-500 mb-1 italic"><strong>Hint:</strong> ${challenge.hint}</p>` : '';
            challengesSolutions.innerHTML += `
                <div>
                    <p class="font-medium">${challenge.prompt}</p>
                    ${hintHTML}
                    <div class="code-block">${challenge.solution.replace(/</g, "&lt;")}</div>
                </div>
            `;
        });
        solutionsDiv.appendChild(challengesSolutions);
        groupEl.appendChild(solutionsDiv);

        const unlockDiv = document.createElement('div');
        unlockDiv.className = 'mt-4 space-y-2 sm:space-y-0 sm:flex sm:space-x-2';
        unlockDiv.setAttribute('data-unlock-id', `lab-${groupIndex}`);
        unlockDiv.innerHTML = `
            <input type="password" placeholder="Enter password for solutions" class="w-full sm:flex-grow p-2 border rounded-md">
            <button class="w-full sm:w-auto bg-[var(--brand-blue)] hover:bg-[#0f4a81] text-white font-semibold px-4 py-2 rounded-md">Unlock</button>
        `;
        groupEl.appendChild(unlockDiv);
        const errorEl = document.createElement('p');
        errorEl.className = 'text-red-600 text-sm mt-1 h-4';
        errorEl.setAttribute('data-error-id', `lab-${groupIndex}`);
        groupEl.appendChild(errorEl);

        labContainer.appendChild(groupEl);
    });

    const playgroundContainer = document.getElementById('playground-container');
    
    function renderPlayground() {
        const challenge = playgroundData.challenges[currentPlaygroundChallenge];
        playgroundContainer.innerHTML = `
            <div>
                <h4 class="font-semibold text-lg mb-2">Challenge #${currentPlaygroundChallenge + 1} of ${playgroundData.challenges.length}</h4>
                <p class="mb-4 text-gray-700">${challenge.question}</p>
            </div>
            <div class="mt-6">
                <textarea id="query-input" rows="4" class="w-full p-2 rounded-md" placeholder="SELECT ..."></textarea>
                <div id="feedback" class="text-sm my-2 h-5 font-medium"></div>
                <div class="grid grid-cols-2 lg:grid-cols-3 gap-2">
                    <button id="run-query" class="w-full text-white font-semibold px-4 py-2 rounded-md">Run DQL</button>
                    <button id="reset-query" class="w-full bg-gray-500 hover:bg-gray-600 text-white font-semibold px-4 py-2 rounded-md">Reset</button>
                    <button id="next-challenge" class="hidden lg:block w-full bg-green-600 hover:bg-green-700 text-white font-semibold px-4 py-2 rounded-md">Next Challenge &rarr;</button>
                </div>
                 <button id="next-challenge-mobile" class="hidden lg:hidden mt-2 w-full bg-green-600 hover:bg-green-700 text-white font-semibold px-4 py-2 rounded-md">Next Challenge &rarr;</button>
            </div>
            <div class="mt-6">
                <h5 class="font-semibold mb-2">Resulting Table Data</h5>
                <div id="result-table">
                </div>
            </div>
        `;
        document.getElementById('result-table').innerHTML = renderTable(playgroundData.initialData);
    }
    
    function renderTable(data) {
        if (!data || data.length === 0) return '<p class="text-gray-500 italic">No data to display.</p>';
        const headers = Object.keys(data[0]);
        let table = '<div class="overflow-x-auto"><table class="w-full text-sm text-left"><thead><tr class="bg-gray-100">';
        headers.forEach(h => table += `<th class="p-2">${h}</th>`);
        table += '</tr></thead><tbody>';
        data.forEach(row => {
            table += '<tr class="border-b">';
            headers.forEach(h => table += `<td class="p-2">${row[h]}</td>`);
            table += '</tr>';
        });
        table += '</tbody></table></div>';
        return table;
    }

    function runQuery() {
        const query = document.getElementById('query-input').value;
        const feedbackEl = document.getElementById('feedback');
        const resultTable = document.getElementById('result-table');
        const nextBtn = document.getElementById('next-challenge');
        const nextBtnMobile = document.getElementById('next-challenge-mobile');
        const challenge = playgroundData.challenges[currentPlaygroundChallenge];

        if (challenge.validate(query)) {
            feedbackEl.textContent = 'Correct! Data updated.';
            feedbackEl.className = 'text-sm my-2 h-5 font-medium text-green-600';
            nextBtn.classList.remove('hidden');
            nextBtnMobile.classList.remove('hidden');
            
            // Simulate the DQL operation
            // This is a simplified simulation for the playground
            let resultData = [];
            if (currentPlaygroundChallenge === 0) { 
                resultData = playgroundData.initialData.map(e => ({name: e.name, salary: e.salary}));
            } else if (currentPlaygroundChallenge === 1) { 
                resultData = playgroundData.initialData.filter(e => e.department === 'Engineering');
            } else if (currentPlaygroundChallenge === 2) { 
                resultData = [...playgroundData.initialData].sort((a, b) => b.salary - a.salary);
            } else if (currentPlaygroundChallenge === 3) {
                 resultData = [{department: 'Sales', count: 2}, {department: 'Engineering', count: 2}, {department: 'Marketing', count: 1}];
            } else if (currentPlaygroundChallenge === 4) {
                 resultData = [{average_salary: 77500}];
            }
            resultTable.innerHTML = renderTable(resultData);

        } else {
            feedbackEl.textContent = 'Not quite right. Check your syntax!';
            feedbackEl.className = 'text-sm my-2 h-5 font-medium text-red-600';
            nextBtn.classList.add('hidden');
            nextBtnMobile.classList.add('hidden');
            resultTable.innerHTML = renderTable(playgroundData.initialData);
        }
    }

    function resetQuery() {
        document.getElementById('query-input').value = '';
        const feedbackEl = document.getElementById('feedback');
        feedbackEl.textContent = '';
        feedbackEl.className = 'text-sm my-2 h-5 font-medium';
        document.getElementById('result-table').innerHTML = renderTable(playgroundData.initialData);
        document.getElementById('next-challenge').classList.add('hidden');
        document.getElementById('next-challenge-mobile').classList.add('hidden');
    }
    
    function handlePlaygroundClick(e) {
        if (e.target.id === 'run-query') runQuery();
        if (e.target.id === 'reset-query') resetQuery();
        if (e.target.id === 'next-challenge' || e.target.id === 'next-challenge-mobile') {
            currentPlaygroundChallenge = (currentPlaygroundChallenge + 1) % playgroundData.challenges.length;
            renderPlayground();
        }
    }
    
    renderPlayground();
    playgroundContainer.addEventListener('click', handlePlaygroundClick);

    const activityContainer = document.getElementById('activity-container');
    
    function renderActivity() {
        const activity = activityData[currentActivityIndex];
        activityContainer.innerHTML = `
            <div class="bg-brand-white p-6 rounded-lg shadow-lg">
                <div class="flex justify-between items-center mb-4">
                    <h4 class="font-semibold text-lg text-gray-800">${currentActivityIndex + 1}. ${activity.question}</h4>
                    <span class="text-sm font-medium text-gray-500">${currentActivityIndex + 1} / ${activityData.length}</span>
                </div>
                <div class="mt-4 p-4 rounded-lg locked-answer" data-answer-id="${currentActivityIndex}">
                    <div class="code-block">${activity.answer.replace(/</g, "&lt;")}</div>
                </div>
                <div class="mt-4 space-y-2 sm:space-y-0 sm:flex sm:space-x-2" data-unlock-id="${currentActivityIndex}">
                    <input type="password" placeholder="Enter password to unlock" class="w-full sm:flex-grow p-2 border rounded-md">
                    <button class="w-full sm:w-auto bg-[var(--brand-blue)] hover:bg-[#0f4a81] text-white font-semibold px-4 py-2 rounded-md">Unlock</button>
                </div>
                <p class="text-red-600 text-sm mt-1 h-4" data-error-id="${currentActivityIndex}"></p>
            </div>
            <div class="flex justify-between mt-4">
                <button id="prev-activity" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded">&larr; Previous</button>
                <button id="next-activity" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded">Next &rarr;</button>
            </div>
        `;
        document.getElementById('prev-activity').disabled = currentActivityIndex === 0;
        document.getElementById('next-activity').disabled = currentActivityIndex === activityData.length - 1;
    }

    function handlePasswordUnlock(e, password) {
        const wrapper = e.target.closest('[data-unlock-id]');
        if (!wrapper || !e.target.matches('button')) return;
        
        const id = wrapper.dataset.unlockId;
        const input = wrapper.querySelector('input');
        const answerEl = document.querySelector(`[data-answer-id="${id}"]`);
        const errorEl = document.querySelector(`[data-error-id="${id}"]`);

        if (input.value === password) {
            answerEl.classList.remove('locked-answer');
            answerEl.classList.add('unlocked-answer');
            errorEl.textContent = '';
        } else {
            errorEl.textContent = 'Wrong password.';
            input.value = '';
        }
    }

    function handlePasswordInput(e) {
        if(e.target.tagName !== 'INPUT' || e.target.type !== 'password') return;
        
        const wrapper = e.target.closest('[data-unlock-id]');
        const id = wrapper.dataset.unlockId;
        const answerEl = document.querySelector(`[data-answer-id="${id}"]`);

        if(e.target.value === '') {
           answerEl.classList.add('locked-answer');
           answerEl.classList.remove('unlocked-answer');
        }
    }

    document.getElementById('lab-challenges').addEventListener('click', e => handlePasswordUnlock(e, labPassword));
    document.getElementById('lab-challenges').addEventListener('input', handlePasswordInput);
    
    const activitySection = document.getElementById('activity-container');
    activitySection.addEventListener('click', e => {
        handlePasswordUnlock(e, activityPassword);
        if (e.target.id === 'next-activity' && currentActivityIndex < activityData.length - 1) {
            currentActivityIndex++;
            renderActivity();
        }
        if (e.target.id === 'prev-activity' && currentActivityIndex > 0) {
            currentActivityIndex--;
            renderActivity();
        }
    });
    activitySection.addEventListener('input', handlePasswordInput);
    
    renderActivity();
    
});
</script>

</body>
</html>
